<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSS Intelligent Chatbot</title>
    
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* NSS Color Variables */
        :root {
            --nss-blue: #002366;
            --nss-red: #FF2C2C;
            --nss-white: #FFFFFF;
            --nss-light-blue: #f0f4f8;
        }

        /* Subtle background watermark pattern */
        .background-watermark {
            background-color: var(--nss-white);
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(0, 35, 102, 0.03) 1px, transparent 1px),
                radial-gradient(circle at 80% 90%, rgba(0, 35, 102, 0.03) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(0, 35, 102, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Custom button style */
        .nss-button {
            border: 2px solid var(--nss-red);
            color: var(--nss-red);
            background-color: var(--nss-white);
            transition: all 0.3s ease;
        }

        .nss-button:hover {
            background-color: var(--nss-blue);
            color: var(--nss-white);
            border-color: var(--nss-blue);
        }

        /* Scrollbar styling */
        #chat-window::-webkit-scrollbar {
            width: 6px;
        }
        #chat-window::-webkit-scrollbar-track {
            background: var(--nss-light-blue);
        }
        #chat-window::-webkit-scrollbar-thumb {
            background-color: var(--nss-blue);
            border-radius: 10px;
        }

        /* Typing indicator animation */
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #AAB8C2;
            display: inline-block;
            border-radius: 50%;
            animation: bounce 1.3s infinite;
        }
        .typing-indicator span:nth-of-type(2) {
            animation-delay: 0.15s;
        }
        .typing-indicator span:nth-of-type(3) {
            animation-delay: 0.3s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        
        /* Voice recognition pulse animation */
        .mic-active {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 44, 44, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 44, 44, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 44, 44, 0); }
        }

        /* Gemini button loading spinner */
        .spinner {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--nss-blue);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="chatbot-container" class="w-full max-w-lg h-[95vh] max-h-[800px] flex flex-col bg-white shadow-2xl rounded-2xl overflow-hidden background-watermark">
        
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-sm p-4 border-b border-gray-200 flex items-center justify-between shadow-sm">
            <div class="flex items-center space-x-3">
                <img src="nss.jpg" alt="NSS Logo" class="h-12 w-12 rounded-full object-cover" onerror="this.onerror=null; this.src='https://placehold.co/48x48/002366/FFFFFF?text=NSS';">
                <div>
                    <h1 class="text-lg font-bold text-[--nss-blue]">NSS Tist Bot</h1>
                    <p id="slogan" class="text-xs text-gray-500">‡¥Æ‡¥®‡¥∏‡µç ‡¥®‡¥®‡µç‡¥®‡¥æ‡¥µ‡¥ü‡µç‡¥ü‡µÜ ‚Äì Let the Mind be Noble</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                 <button id="voice-output-toggle" class="p-2 rounded-full hover:bg-gray-200 text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.88 5.88a15 15 0 00-2.828 12.254M21 12a9 9 0 00-9-9" /></svg>
                </button>
                <button id="language-toggle" class="nss-button text-sm font-semibold py-1 px-3 rounded-full">
                    English
                </button>
            </div>
        </header>

        <!-- Chat Window -->
        <main id="chat-window" class="flex-1 p-4 overflow-y-auto space-y-4">
            <!-- Messages will be appended here -->
        </main>

        <!-- Quick Info Menu -->
        <div class="p-2 bg-white/80 backdrop-blur-sm border-t border-gray-200">
            <div id="quick-info-container" class="flex justify-around">
                <!-- Quick info buttons will be populated by JS -->
            </div>
        </div>

        <!-- Input Area -->
        <footer class="p-4 bg-white border-t border-gray-200">
            <div class="flex items-center space-x-2">
                <input type="text" id="user-input" placeholder="Type an event idea & click the ‚ú®" class="flex-1 w-full px-4 py-2 bg-gray-100 rounded-full focus:outline-none focus:ring-2 focus:ring-[--nss-blue]">
                <button id="mic-button" class="p-3 rounded-full text-gray-500 hover:bg-red-100 hover:text-[--nss-red] transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                </button>
                <button id="gemini-button" class="p-3 rounded-full bg-yellow-400 text-white hover:bg-yellow-500 transition-colors" title="Plan an Event with Gemini">
                    ‚ú®
                </button>
                <button id="send-button" class="p-3 rounded-full bg-[--nss-blue] text-white hover:bg-opacity-90 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENTS ---
            const chatWindow = document.getElementById('chat-window');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const micButton = document.getElementById('mic-button');
            const geminiButton = document.getElementById('gemini-button');
            const languageToggle = document.getElementById('language-toggle');
            const voiceOutputToggle = document.getElementById('voice-output-toggle');
            const quickInfoContainer = document.getElementById('quick-info-container');

            // --- STATE ---
            let currentLanguage = 'en';
            let isVoiceOutputEnabled = true;
            let isRecognizing = false;
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
            }

            // --- DATA & CONTENT ---

            const quotes = [
                "Arise, awake, and stop not till the goal is reached. - Swami Vivekananda",
                "The best way to find yourself is to lose yourself in the service of others. - Mahatma Gandhi",
                "You cannot believe in God until you believe in yourself. - Swami Vivekananda",
                "Service which is rendered without joy helps neither the servant nor the served. - Mahatma Gandhi",
                "Take up one idea. Make that one idea your life... this is the way to success. - Swami Vivekananda"
            ];

            const uiText = {
                en: {
                    langButton: "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç",
                    inputPlaceholder: "Ask a question or type an event idea & click ‚ú®",
                    welcome: "Hello! I am the NSS Tist Bot. Ask me anything about NSS, or type an event idea and click the ‚ú® button to let me plan it for you!",
                    quickInfo: [
                        { text: "Events", icon: "üìÖ", query: "Upcoming events" },
                        { text: "Join NSS", icon: "ü§ù", query: "How to join NSS" },
                        { text: "History", icon: "üìñ", query: "NSS History" },
                        { text: "Gallery", icon: "üñºÔ∏è", query: "Show me the gallery" }
                    ]
                },
                ml: {
                    langButton: "English",
                    inputPlaceholder: "‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥í‡¥∞‡µÅ ‡¥á‡¥µ‡¥®‡µç‡¥±‡µç ‡¥Ü‡¥∂‡¥Ø‡¥Ç ‡¥ü‡µà‡¥™‡µç‡¥™‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‚ú® ‡¥ï‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï",
                    welcome: "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª NSS Tist Bot ‡¥Ü‡¥£‡µç. NSS-‡¥®‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥é‡¥®‡µç‡¥§‡µÅ‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç, ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥í‡¥∞‡µÅ ‡¥á‡¥µ‡¥®‡µç‡¥±‡µç ‡¥Ü‡¥∂‡¥Ø‡¥Ç ‡¥®‡µΩ‡¥ï‡¥ø ‚ú® ‡¥¨‡¥ü‡µç‡¥ü‡µ∫ ‡¥ï‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥æ‡µΩ ‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø ‡¥Ö‡¥§‡µç ‡¥™‡µç‡¥≤‡¥æ‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥Ç!",
                    quickInfo: [
                        { text: "‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡µæ", icon: "üìÖ", query: "‡¥µ‡¥∞‡¥æ‡¥®‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡µæ" },
                        { text: "‡¥ö‡µá‡¥∞‡µÅ‡¥ï", icon: "ü§ù", query: "‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ NSS-‡µΩ ‡¥ö‡µá‡¥∞‡¥æ‡¥Ç" },
                        { text: "‡¥ö‡¥∞‡¥ø‡¥§‡µç‡¥∞‡¥Ç", icon: "üìñ", query: "NSS ‡¥ö‡¥∞‡¥ø‡¥§‡µç‡¥∞‡¥Ç" },
                        { text: "‡¥ó‡¥æ‡¥≤‡¥±‡¥ø", icon: "üñºÔ∏è", query: "‡¥ó‡¥æ‡¥≤‡¥±‡¥ø ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ" }
                    ]
                }
            };
            
            const knowledgeBase = {
                en: {
                    'default': "I'm not sure how to answer that. For event planning, type your idea and click the ‚ú® button. For general questions, please try rephrasing or use the Quick Info buttons.",
                    'greeting': "Hello there! Ready to make a difference? Ask me a question or let's plan an event together!",
                    'what is nss': "The National Service Scheme (NSS) is a Central Sector Scheme of Government of India, Ministry of Youth Affairs & Sports. It provides opportunity to the student youth of 11th & 12th Class of schools at +2 Board level and student youth of Technical Institution, Graduate & Post Graduate at colleges and University level of India to take part in various government led community service activities & programmes.",
                    'how to join': "To join the NSS, you should contact the NSS Programme Officer at your school or college. Enrollment is typically done at the beginning of the academic year. It's a voluntary scheme, open to all students!",
                    'motto': "The motto of National Service Scheme is 'NOT ME BUT YOU'. It reflects the essence of democratic living and upholds the need for selfless service and appreciation of the other person's point of view.",
                    'history': "The NSS was launched in Gandhiji's Centenary year, 1969. It was a dream of Mahatma Gandhi that the youth of the country should be involved in the work of nation-building. The idea was first mooted in 1952, and after several committees and discussions, it was officially launched on 24th September 1969.",
                    'duties|activities': "NSS volunteers undertake various activities such as cleanliness drives, blood donation camps, environmental protection campaigns like tree plantation, disaster management, and awareness programs on health, sanitation, and social issues. The two main types of activities are Regular Activities and Special Camping programmes.",
                    'achievements': "NSS has numerous achievements! Volunteers have played a crucial role in national initiatives like Swachh Bharat Abhiyan, Digital India, and have been at the forefront of relief efforts during natural calamities. Every year, the best volunteers are honored with the NSS National Awards by the President of India.",
                    'events': "Upcoming events often include national-level camps, Republic Day Parade camps, and special campaigns announced by the Ministry of Youth Affairs & Sports. For specific event details at your institution, please contact your NSS Programme Officer.",
                    'gallery': "While I can't display a full gallery here, the official NSS website has a wonderful collection of photos showcasing the incredible work of our volunteers across the nation. It's truly inspiring!",
                    'volunteer secretary|volunteer secretaries|secretary|secretaries': "The Volunteer Secretaries of NSS TIST are Rohit A and Sereena Joshy.",
                    'program officer|programme officer|akhil krishnan': "The NSS TIST Program Officer is <strong>Akhil Krishnan M</strong>.",
                    'senior mentor|niranjan s': "The Senior Mentor of NSS TIST is <strong>Niranjan S</strong>.",
                },
                ml: {
                    'default': "‡¥ï‡µç‡¥∑‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç, ‡¥é‡¥®‡¥ø‡¥ï‡µç‡¥ï‡¥§‡µç ‡¥Æ‡¥®‡¥∏‡µç‡¥∏‡¥ø‡¥≤‡¥æ‡¥Ø‡¥ø‡¥≤‡µç‡¥≤. ‡¥á‡¥µ‡¥®‡µç‡¥±‡µç ‡¥™‡µç‡¥≤‡¥æ‡¥®‡¥ø‡¥Ç‡¥ó‡¥ø‡¥®‡¥æ‡¥Ø‡¥ø, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥∂‡¥Ø‡¥Ç ‡¥ü‡µà‡¥™‡µç‡¥™‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‚ú® ‡¥¨‡¥ü‡µç‡¥ü‡µ∫ ‡¥ï‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï. ‡¥Æ‡¥±‡µç‡¥±‡µç ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç, ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µã ‡¥ï‡µç‡¥µ‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥á‡µª‡¥´‡µã ‡¥¨‡¥ü‡µç‡¥ü‡¥£‡µÅ‡¥ï‡µæ ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µã ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.",
                    'greeting': "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥í‡¥∞‡µÅ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡¥æ‡µª ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥£‡µã? ‡¥é‡¥®‡µç‡¥®‡µã‡¥ü‡µç ‡¥í‡¥∞‡µÅ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÇ ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥®‡¥Æ‡µÅ‡¥ï‡µç‡¥ï‡µç ‡¥í‡¥∞‡µÅ‡¥Æ‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥í‡¥∞‡µÅ ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø ‡¥Ü‡¥∏‡µÇ‡¥§‡µç‡¥∞‡¥£‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥Ç!",
                    'what is nss': "‡¥®‡¥æ‡¥∑‡¥£‡µΩ ‡¥∏‡µº‡¥µ‡µÄ‡¥∏‡µç ‡¥∏‡µç‡¥ï‡µÄ‡¥Ç (NSS) ‡¥≠‡¥æ‡¥∞‡¥§ ‡¥∏‡µº‡¥ï‡µç‡¥ï‡¥æ‡¥∞‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Ø‡µÅ‡¥µ‡¥ú‡¥®‡¥ï‡¥æ‡¥∞‡µç‡¥Ø-‡¥ï‡¥æ‡¥Ø‡¥ø‡¥ï ‡¥Æ‡¥®‡µç‡¥§‡µç‡¥∞‡¥æ‡¥≤‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥®‡µç ‡¥ï‡µÄ‡¥¥‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥í‡¥∞‡µÅ ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞ ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥Ø‡¥æ‡¥£‡µç. ‡¥á‡¥§‡µç +2 ‡¥§‡¥≤‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥∏‡µç‡¥ï‡µÇ‡µæ ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç, ‡¥ï‡µã‡¥≥‡µá‡¥ú‡µç, ‡¥∏‡µº‡¥µ‡µç‡¥µ‡¥ï‡¥≤‡¥æ‡¥∂‡¥æ‡¥≤ ‡¥§‡¥≤‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥µ‡¥ø‡¥ß ‡¥∏‡¥æ‡¥Æ‡µÇ‡¥π‡¥ø‡¥ï ‡¥∏‡µá‡¥µ‡¥® ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡¥≥‡¥ø‡¥≤‡µÅ‡¥Ç ‡¥™‡¥ô‡µç‡¥ï‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥Ö‡¥µ‡¥∏‡¥∞‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                    'how to join|‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ ‡¥ö‡µá‡¥∞‡¥æ‡¥Ç': "NSS-‡µΩ ‡¥ö‡µá‡¥∞‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µç, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥ï‡µÇ‡¥≥‡¥ø‡¥≤‡µÜ‡¥Ø‡µã ‡¥ï‡µã‡¥≥‡µá‡¥ú‡¥ø‡¥≤‡µÜ‡¥Ø‡µã NSS ‡¥™‡µç‡¥∞‡µã‡¥ó‡µç‡¥∞‡¥æ‡¥Ç ‡¥ì‡¥´‡µÄ‡¥∏‡¥±‡µÅ‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥¨‡¥®‡µç‡¥ß‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï. ‡¥∏‡¥æ‡¥ß‡¥æ‡¥∞‡¥£‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥Ö‡¥ß‡µç‡¥Ø‡¥Ø‡¥® ‡¥µ‡µº‡¥∑‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡µÅ‡¥ü‡¥ï‡µç‡¥ï‡¥§‡µç‡¥§‡¥ø‡¥≤‡¥æ‡¥£‡µç ‡¥é‡µª‡¥±‡µã‡µæ‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µç ‡¥®‡¥ü‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç. ‡¥á‡¥§‡µç ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥§‡µÅ‡¥±‡¥®‡µç‡¥® ‡¥í‡¥∞‡µÅ ‡¥∏‡¥®‡µç‡¥®‡¥¶‡µç‡¥ß ‡¥™‡¥¶‡µç‡¥ß‡¥§‡¥ø‡¥Ø‡¥æ‡¥£‡µç!",
                    'motto|‡¥Æ‡µÅ‡¥¶‡µç‡¥∞‡¥æ‡¥µ‡¥æ‡¥ï‡µç‡¥Ø‡¥Ç': "‡¥®‡¥æ‡¥∑‡¥£‡µΩ ‡¥∏‡µº‡¥µ‡µÄ‡¥∏‡µç ‡¥∏‡µç‡¥ï‡µÄ‡¥Æ‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Æ‡µÅ‡¥¶‡µç‡¥∞‡¥æ‡¥µ‡¥æ‡¥ï‡µç‡¥Ø‡¥Ç '‡¥û‡¥æ‡¥®‡¥≤‡µç‡¥≤, ‡¥®‡µÄ' (NOT ME BUT YOU) ‡¥é‡¥®‡µç‡¥®‡¥§‡¥æ‡¥£‡µç. ‡¥á‡¥§‡µç ‡¥ú‡¥®‡¥æ‡¥ß‡¥ø‡¥™‡¥§‡µç‡¥Ø ‡¥ú‡µÄ‡¥µ‡¥ø‡¥§‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥∏‡¥§‡µç‡¥§‡¥Ø‡µÜ ‡¥™‡µç‡¥∞‡¥§‡¥ø‡¥´‡¥≤‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥®‡¥ø‡¥∏‡µç‡¥µ‡¥æ‡µº‡¥§‡µç‡¥• ‡¥∏‡µá‡¥µ‡¥®‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥ï‡¥§‡¥Ø‡µÜ ‡¥â‡¥Ø‡µº‡¥§‡µç‡¥§‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                    'history|‡¥ö‡¥∞‡¥ø‡¥§‡µç‡¥∞‡¥Ç': "‡¥ó‡¥æ‡¥®‡µç‡¥ß‡¥ø‡¥ú‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥®‡µÇ‡¥±‡¥æ‡¥Ç ‡¥ú‡¥®‡µç‡¥Æ‡¥µ‡¥æ‡µº‡¥∑‡¥ø‡¥ï‡¥Æ‡¥æ‡¥Ø 1969-‡¥≤‡¥æ‡¥£‡µç NSS ‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡¥§‡µç. ‡¥∞‡¥æ‡¥ú‡µç‡¥Ø‡¥§‡µç‡¥§‡µÜ ‡¥Ø‡µÅ‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡µæ ‡¥∞‡¥æ‡¥∑‡µç‡¥ü‡µç‡¥∞ ‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥æ‡¥£ ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥™‡¥ô‡µç‡¥ï‡¥æ‡¥≥‡¥ø‡¥ï‡¥≥‡¥æ‡¥ï‡¥£‡¥Ç ‡¥é‡¥®‡µç‡¥®‡¥§‡µç ‡¥Æ‡¥π‡¥æ‡¥§‡µç‡¥Æ‡¥æ‡¥ó‡¥æ‡¥®‡µç‡¥ß‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥í‡¥∞‡µÅ ‡¥∏‡µç‡¥µ‡¥™‡µç‡¥®‡¥Æ‡¥æ‡¥Ø‡¥ø‡¥∞‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥à ‡¥Ü‡¥∂‡¥Ø‡¥Ç 1952-‡µΩ ‡¥Ü‡¥¶‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥ö‡µº‡¥ö‡µç‡¥ö ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç, ‡¥®‡¥ø‡¥∞‡¥µ‡¥ß‡¥ø ‡¥ï‡¥Æ‡µç‡¥Æ‡¥ø‡¥±‡µç‡¥±‡¥ø‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥ö‡µº‡¥ö‡µç‡¥ö‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥∂‡µá‡¥∑‡¥Ç 1969 ‡¥∏‡µÜ‡¥™‡µç‡¥±‡µç‡¥±‡¥Ç‡¥¨‡µº 24-‡¥®‡µç ‡¥î‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥∏‡¥Æ‡¥æ‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µÅ.",
                    'duties|activities|‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ': "‡¥∂‡µÅ‡¥ö‡µÄ‡¥ï‡¥∞‡¥£ ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ, ‡¥∞‡¥ï‡µç‡¥§‡¥¶‡¥æ‡¥® ‡¥ï‡µç‡¥Ø‡¥æ‡¥Æ‡µç‡¥™‡µÅ‡¥ï‡µæ, ‡¥µ‡µÉ‡¥ï‡µç‡¥∑‡¥§‡µç‡¥§‡µà ‡¥®‡¥ü‡µÄ‡µΩ ‡¥™‡µã‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥™‡¥∞‡¥ø‡¥∏‡µç‡¥•‡¥ø‡¥§‡¥ø ‡¥∏‡¥Ç‡¥∞‡¥ï‡µç‡¥∑‡¥£ ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ, ‡¥¶‡µÅ‡¥∞‡¥®‡µç‡¥§‡¥®‡¥ø‡¥µ‡¥æ‡¥∞‡¥£‡¥Ç, ‡¥Ü‡¥∞‡µã‡¥ó‡µç‡¥Ø‡µç‡¥Ø‡¥Ç, ‡¥∂‡µÅ‡¥ö‡¥ø‡¥§‡µç‡¥µ‡¥Ç, ‡¥∏‡¥æ‡¥Æ‡µÇ‡¥π‡¥ø‡¥ï ‡¥™‡µç‡¥∞‡¥∂‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡¥Ø‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µÅ‡¥≥‡µç‡¥≥ ‡¥¨‡µã‡¥ß‡¥µ‡µΩ‡¥ï‡µç‡¥ï‡¥∞‡¥£ ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡µæ ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥ø‡¥Ø ‡¥µ‡¥ø‡¥µ‡¥ø‡¥ß ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ NSS ‡¥µ‡µã‡¥≥‡¥®‡µç‡¥±‡¥ø‡¥Ø‡µº‡¥Æ‡¥æ‡µº ‡¥è‡¥±‡µç‡¥±‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                    'achievements|‡¥®‡µá‡¥ü‡µç‡¥ü‡¥ô‡µç‡¥ô‡µæ': "NSS-‡¥®‡µç ‡¥®‡¥ø‡¥∞‡¥µ‡¥ß‡¥ø ‡¥®‡µá‡¥ü‡µç‡¥ü‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥£‡µç‡¥ü‡µç! ‡¥∏‡µç‡¥µ‡¥ö‡µç‡¥õ‡µç ‡¥≠‡¥æ‡¥∞‡¥§‡µç ‡¥Ö‡¥≠‡¥ø‡¥Ø‡¥æ‡µª, ‡¥°‡¥ø‡¥ú‡¥ø‡¥±‡µç‡¥±‡µΩ ‡¥á‡¥®‡µç‡¥§‡µç‡¥Ø ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥ø‡¥Ø ‡¥¶‡µá‡¥∂‡µÄ‡¥Ø ‡¥∏‡¥Ç‡¥∞‡¥Ç‡¥≠‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥µ‡µã‡¥≥‡¥®‡µç‡¥±‡¥ø‡¥Ø‡µº‡¥Æ‡¥æ‡µº ‡¥®‡¥ø‡µº‡¥£‡¥æ‡¥Ø‡¥ï ‡¥™‡¥ô‡µç‡¥ï‡µç ‡¥µ‡¥π‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µç. ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥µ‡µº‡¥∑‡¥µ‡µÅ‡¥Ç ‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥µ‡µã‡¥≥‡¥®‡µç‡¥±‡¥ø‡¥Ø‡µº‡¥Æ‡¥æ‡¥∞‡µÜ ‡¥∞‡¥æ‡¥∑‡µç‡¥ü‡µç‡¥∞‡¥™‡¥§‡¥ø NSS ‡¥¶‡µá‡¥∂‡µÄ‡¥Ø ‡¥Ö‡¥µ‡¥æ‡µº‡¥°‡µÅ‡¥ï‡µæ ‡¥®‡µΩ‡¥ï‡¥ø ‡¥Ü‡¥¶‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
                    'events|‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡µæ': "‡¥µ‡¥∞‡¥æ‡¥®‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡¥≥‡¥ø‡µΩ ‡¥¶‡µá‡¥∂‡µÄ‡¥Ø ‡¥§‡¥≤‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µç‡¥Ø‡¥æ‡¥Æ‡µç‡¥™‡µÅ‡¥ï‡µæ, ‡¥±‡¥ø‡¥™‡µç‡¥™‡¥¨‡µç‡¥≤‡¥ø‡¥ï‡µç ‡¥¶‡¥ø‡¥® ‡¥™‡¥∞‡µá‡¥°‡µç ‡¥ï‡µç‡¥Ø‡¥æ‡¥Æ‡µç‡¥™‡µÅ‡¥ï‡µæ, ‡¥Ø‡µÅ‡¥µ‡¥ú‡¥®‡¥ï‡¥æ‡¥∞‡µç‡¥Ø-‡¥ï‡¥æ‡¥Ø‡¥ø‡¥ï ‡¥Æ‡¥®‡µç‡¥§‡µç‡¥∞‡¥æ‡¥≤‡¥Ø‡¥Ç ‡¥™‡µç‡¥∞‡¥ñ‡µç‡¥Ø‡¥æ‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥™‡µç‡¥∞‡¥§‡µç‡¥Ø‡µá‡¥ï ‡¥™‡µç‡¥∞‡¥ö‡¥æ‡¥∞‡¥£‡¥ô‡µç‡¥ô‡µæ ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ ‡¥â‡µæ‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥•‡¥æ‡¥™‡¥®‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÜ ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥ü‡¥ø‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡¥ø‡¥∂‡¥¶‡¥æ‡¥Ç‡¥∂‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø, ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ NSS ‡¥™‡µç‡¥∞‡µã‡¥ó‡µç‡¥∞‡¥æ‡¥Ç ‡¥ì‡¥´‡µÄ‡¥∏‡¥±‡µÅ‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥¨‡¥®‡µç‡¥ß‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥ï.",
                    'gallery|‡¥ó‡¥æ‡¥≤‡¥±‡¥ø': "‡¥é‡¥®‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥í‡¥∞‡µÅ ‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥ó‡¥æ‡¥≤‡¥±‡¥ø ‡¥™‡µç‡¥∞‡¥¶‡µº‡¥∂‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥ï‡¥¥‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤, ‡¥™‡¥ï‡µç‡¥∑‡µá ‡¥î‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥ø‡¥ï NSS ‡¥µ‡µÜ‡¥¨‡µç‡¥∏‡µà‡¥±‡µç‡¥±‡¥ø‡µΩ ‡¥®‡¥Æ‡µç‡¥Æ‡µÅ‡¥ü‡µÜ ‡¥µ‡µã‡¥≥‡¥®‡µç‡¥±‡¥ø‡¥Ø‡µº‡¥Æ‡¥æ‡¥∞‡µÅ‡¥ü‡µÜ ‡¥Ö‡¥µ‡¥ø‡¥∂‡µç‡¥µ‡¥∏‡¥®‡µÄ‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥´‡µã‡¥ü‡µç‡¥ü‡µã‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥í‡¥∞‡µÅ ‡¥Ö‡¥§‡µç‡¥≠‡µÅ‡¥§‡¥ï‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥∂‡µá‡¥ñ‡¥∞‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡µç. ‡¥Ö‡¥§‡µç ‡¥§‡µÄ‡µº‡¥ö‡µç‡¥ö‡¥Ø‡¥æ‡¥Ø‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥ö‡µã‡¥¶‡¥®‡¥ï‡¥∞‡¥Æ‡¥æ‡¥£‡µç!",
                    'volunteer secretary|volunteer secretaries|secretary|secretaries': "NSS TIST-‡¥®‡µç‡¥±‡µÜ ‡¥µ‡µã‡¥≥‡¥®‡µç‡¥±‡¥ø‡¥Ø‡µº ‡¥∏‡µÜ‡¥ï‡µç‡¥∞‡¥ü‡µç‡¥ü‡¥±‡¥ø‡¥Æ‡¥æ‡µº <strong>‡¥±‡µã‡¥π‡¥ø‡¥§‡µç ‡¥é</strong>‡¥Ø‡µÅ‡¥Ç <strong>‡¥∏‡µÜ‡¥±‡µÄ‡¥® ‡¥ú‡µã‡¥∑‡¥ø‡¥Ø‡µÅ‡¥Ç</strong> ‡¥Ü‡¥£‡µç.",
                    'program officer|programme officer|akhil krishnan': "NSS TIST-‡¥®‡µç‡¥±‡µÜ ‡¥™‡µç‡¥∞‡µã‡¥ó‡µç‡¥∞‡¥æ‡¥Ç ‡¥ì‡¥´‡µÄ‡¥∏‡µº <strong>‡¥Ö‡¥ñ‡¥ø‡µΩ ‡¥ï‡µÉ‡¥∑‡µç‡¥£‡µª ‡¥é‡¥Ç</strong> ‡¥Ü‡¥£‡µç.",
                    'senior mentor|niranjan s': "NSS TIST-‡¥®‡µç‡¥±‡µÜ ‡¥∏‡µÄ‡¥®‡¥ø‡¥Ø‡µº ‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µº <strong>‡¥®‡¥ø‡¥∞‡¥û‡µç‡¥ú‡µª ‡¥é‡¥∏‡µç</strong> ‡¥Ü‡¥£‡µç.",
                }
            };

            // --- FUNCTIONS ---

            const addMessage = (text, sender, isHtml = false) => {
                const messageElement = document.createElement('div');
                messageElement.className = `flex w-full ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const bubbleClass = sender === 'user' 
                    ? 'bg-[--nss-red] text-white' 
                    : 'bg-[--nss-blue] text-white';

                messageElement.innerHTML = `
                    <div class="max-w-xs md:max-w-md p-3 rounded-2xl ${bubbleClass} shadow-md">
                        <div class="text-sm">${isHtml ? text : text.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return messageElement;
            };

            const showTypingIndicator = () => {
                const typingElement = document.createElement('div');
                typingElement.id = 'typing-indicator';
                typingElement.className = 'flex justify-start';
                typingElement.innerHTML = `
                    <div class="max-w-xs md:max-w-md p-3 rounded-2xl bg-gray-200 shadow-md">
                        <div class="typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                `;
                chatWindow.appendChild(typingElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            const removeTypingIndicator = () => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
            };

            const typeMessage = (text, isHtml = false) => {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    const messageElement = addMessage('', 'bot', isHtml);
                    const bubble = messageElement.querySelector('.text-sm');
                    
                    if (isHtml) {
                        bubble.innerHTML = text;
                        chatWindow.scrollTop = chatWindow.scrollHeight;
                        if (isVoiceOutputEnabled) {
                            // Create a plain text version for speech synthesis
                            const plainText = new DOMParser().parseFromString(text, "text/html").documentElement.textContent;
                            speakText(plainText);
                        }
                        return;
                    }

                    let i = 0;
                    const typingSpeed = 20;

                    function type() {
                        if (i < text.length) {
                            bubble.innerHTML += text.charAt(i);
                            i++;
                            chatWindow.scrollTop = chatWindow.scrollHeight;
                            setTimeout(type, typingSpeed);
                        } else {
                            if (Math.random() < 0.3) {
                                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                                bubble.innerHTML += `<br><br><em class="text-xs opacity-80">"${randomQuote}"</em>`;
                            }
                            chatWindow.scrollTop = chatWindow.scrollHeight;
                            if (isVoiceOutputEnabled) {
                                speakText(text);
                            }
                        }
                    }
                    type();
                }, 1000 + Math.random() * 500);
            };

            const speakText = (text) => {
                if (!('speechSynthesis' in window) || !isVoiceOutputEnabled) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text.split('<br>')[0]);
                utterance.lang = currentLanguage === 'ml' ? 'ml-IN' : 'en-US';
                utterance.rate = 1;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            };
            
            // --- GEMINI API FUNCTION ---
            const planEventWithGemini = async (prompt) => {
                const originalButtonContent = geminiButton.innerHTML;
                geminiButton.innerHTML = '<div class="spinner"></div>';
                geminiButton.disabled = true;

                addMessage(`Planning an event for: "${prompt}"`, 'user');
                showTypingIndicator();

                const apiKey = ""; // API key is handled by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const fullPrompt = `You are an expert event planner for the National Service Scheme (NSS) in Kerala, India. Based on the following idea, create a detailed plan. The plan should include a creative event name, a short description, a detailed agenda with timings, and a list of required materials. Respond ONLY with a JSON object with these exact keys: "eventName", "description", "agenda", "materials". The agenda and materials should be arrays of strings. The event idea is: ${prompt}`;
                
                let chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "eventName": { "type": "STRING" },
                                "description": { "type": "STRING" },
                                "agenda": { "type": "ARRAY", "items": { "type": "STRING" } },
                                "materials": { "type": "ARRAY", "items": { "type": "STRING" } }
                            },
                            required: ["eventName", "description", "agenda", "materials"]
                        }
                    }
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                        const jsonText = result.candidates[0].content.parts[0].text;
                        const plan = JSON.parse(jsonText);

                        const formattedResponse = `
                            <strong class="text-base block mb-2">${plan.eventName}</strong>
                            <p class="mb-3">${plan.description}</p>
                            <strong class="block mb-1">Agenda:</strong>
                            <ul class="list-disc list-inside mb-3">
                                ${plan.agenda.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                            <strong class="block mb-1">Materials Needed:</strong>
                            <ul class="list-disc list-inside">
                                ${plan.materials.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        `;
                        removeTypingIndicator();
                        typeMessage(formattedResponse, true);
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    removeTypingIndicator();
                    typeMessage("I'm sorry, I had trouble creating the event plan. Please try again with a different idea.", false);
                } finally {
                    geminiButton.innerHTML = originalButtonContent;
                    geminiButton.disabled = false;
                }
            };


            const getResponse = (query) => {
                const lowerCaseQuery = query.toLowerCase().trim();
                const knowledge = knowledgeBase[currentLanguage];
                
                if (lowerCaseQuery.includes('hello') || lowerCaseQuery.includes('hi') || lowerCaseQuery.includes('‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç')) {
                    return knowledge['greeting'];
                }

                for (const key in knowledge) {
                    const keywords = key.split('|');
                    if (keywords.some(keyword => lowerCaseQuery.includes(keyword))) {
                        return knowledge[key];
                    }
                }
                return knowledge['default'];
            };

            const handleUserInput = () => {
                const query = userInput.value.trim();
                if (query === '') return;

                addMessage(query, 'user');
                userInput.value = '';

                setTimeout(() => {
                    const response = getResponse(query);
                    typeMessage(response);
                }, 300);
            };
            
            const updateUIForLanguage = () => {
                const langData = uiText[currentLanguage];
                languageToggle.textContent = langData.langButton;
                userInput.placeholder = langData.inputPlaceholder;
                if(recognition) recognition.lang = currentLanguage === 'ml' ? 'ml-IN' : 'en-US';

                quickInfoContainer.innerHTML = '';
                langData.quickInfo.forEach(item => {
                    const button = document.createElement('button');
                    button.className = 'flex flex-col items-center space-y-1 text-center text-[--nss-blue] hover:text-[--nss-red] transition-colors text-xs font-medium';
                    button.innerHTML = `
                        <span class="text-2xl">${item.icon}</span>
                        <span>${item.text}</span>
                    `;
                    button.onclick = () => {
                        if (
                            (currentLanguage === 'en' && item.text === 'Gallery') ||
                            (currentLanguage === 'ml' && item.text === '‡¥ó‡¥æ‡¥≤‡¥±‡¥ø')
                        ) {
                            showGalleryImages();
                        } else {
                            userInput.value = item.query;
                            handleUserInput();
                        }
                    };
                    quickInfoContainer.appendChild(button);
                });
            };

            const toggleLanguage = () => {
                currentLanguage = currentLanguage === 'en' ? 'ml' : 'en';
                updateUIForLanguage();
                const welcomeMessage = uiText[currentLanguage].welcome;
                typeMessage(welcomeMessage);
            };


            // --- EVENT LISTENERS ---
            sendButton.addEventListener('click', handleUserInput);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    // Check if the input is for gemini or regular chat
                    if (userInput.value.trim().length > 0) {
                         handleUserInput(); // Default to regular chat on Enter
                    }
                }
            });

            geminiButton.addEventListener('click', () => {
                const query = userInput.value.trim();
                if (query === '') {
                    typeMessage("Please type an event idea in the text box first, then click the ‚ú® button.");
                    return;
                }
                planEventWithGemini(query);
                userInput.value = '';
            });

            languageToggle.addEventListener('click', toggleLanguage);

            voiceOutputToggle.addEventListener('click', () => {
                isVoiceOutputEnabled = !isVoiceOutputEnabled;
                voiceOutputToggle.classList.toggle('text-[--nss-red]', !isVoiceOutputEnabled);
                voiceOutputToggle.classList.toggle('text-gray-600', isVoiceOutputEnabled);
                if (!isVoiceOutputEnabled) {
                    window.speechSynthesis.cancel();
                }
            });

            if (recognition) {
                micButton.addEventListener('click', () => {
                    if (isRecognizing) {
                        recognition.stop();
                        return;
                    }
                    recognition.start();
                });

                recognition.onstart = () => {
                    isRecognizing = true;
                    micButton.classList.add('mic-active', 'text-[--nss-red]');
                };

                recognition.onspeechend = () => {
                    recognition.stop();
                };
                
                recognition.onend = () => {
                    isRecognizing = false;
                    micButton.classList.remove('mic-active', 'text-[--nss-red]');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                };
                
                recognition.onerror = (event) => {
                    console.error("Speech recognition error", event.error);
                }
            } else {
                micButton.style.display = 'none';
            }


            // --- INITIALIZATION ---
            const initializeChat = () => {
                updateUIForLanguage();
                const welcomeMessage = uiText[currentLanguage].welcome;
                typeMessage(welcomeMessage);
            };

            initializeChat();

            // Function to show gallery images in chat
            const showGalleryImages = () => {
                const imageFiles = [
                    'images/other.jpg',
                    'images/other1.jpg',
                    'images/other3.jpg',
                    'images/other4.jpg'
                ];
                const imagesHtml = imageFiles.map(src =>
                    `<img src="${src}" alt="NSS Gallery" class="w-32 h-32 object-cover rounded-lg m-1 inline-block border border-gray-200 shadow-sm" onerror="this.style.display='none';">`
                ).join('');
                typeMessage(`<div class="flex flex-wrap justify-start">${imagesHtml}</div>`, true);
            };

            // Example: Show gallery images on language toggle (for demo)
            languageToggle.addEventListener('click', () => {
                toggleLanguage();
                showGalleryImages(); // Show images every time language is toggled
            });
        });
    </script>
</body>
</html>
